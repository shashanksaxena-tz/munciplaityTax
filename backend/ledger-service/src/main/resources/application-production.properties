# ========================================
# PRODUCTION APPLICATION PROPERTIES
# Ledger Service - Production Configuration
# ========================================
#
# IMPORTANT: This file contains environment variable placeholders.
# Set actual values via environment variables or external configuration.
# DO NOT commit actual credentials to version control.
#

# ========================================
# Application Info
# ========================================
spring.application.name=ledger-service
server.port=${SERVER_PORT:8087}

# ========================================
# Eureka Service Discovery
# ========================================
eureka.client.service-url.defaultZone=${EUREKA_URL:http://eureka-server:8761/eureka/}
eureka.instance.prefer-ip-address=true
eureka.instance.hostname=${HOSTNAME:localhost}

# ========================================
# PostgreSQL Database
# ========================================
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://postgres:5432/munitax_ledger}
spring.datasource.username=${DATABASE_USERNAME:postgres}
spring.datasource.password=${DATABASE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection Pool Settings (HikariCP)
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:20}
spring.datasource.hikari.minimum-idle=${DB_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=${DB_CONNECTION_TIMEOUT:30000}
spring.datasource.hikari.idle-timeout=${DB_IDLE_TIMEOUT:600000}
spring.datasource.hikari.max-lifetime=${DB_MAX_LIFETIME:1800000}

# JPA/Hibernate
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=${JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ========================================
# Flyway Database Migrations
# ========================================
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.out-of-order=false

# ========================================
# Payment Provider Settings
# ========================================
# Mode: TEST or PRODUCTION
ledger.payment.mode=${PAYMENT_MODE:TEST}
ledger.payment.provider=${PAYMENT_PROVIDER:MOCK}

# Real payment gateway credentials (when PRODUCTION mode)
ledger.payment.gateway.api-key=${PAYMENT_GATEWAY_API_KEY:}
ledger.payment.gateway.api-secret=${PAYMENT_GATEWAY_API_SECRET:}
ledger.payment.gateway.webhook-secret=${PAYMENT_GATEWAY_WEBHOOK_SECRET:}
ledger.payment.gateway.endpoint=${PAYMENT_GATEWAY_ENDPOINT:https://api.stripe.com/v1}

# ========================================
# Security Settings
# ========================================
# CORS Configuration
ledger.security.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:https://app.munitax.com,https://admin.munitax.com}
ledger.security.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
ledger.security.cors.allowed-headers=*
ledger.security.cors.allow-credentials=true

# Rate Limiting
ledger.security.rate-limit.enabled=${RATE_LIMIT_ENABLED:true}
ledger.security.rate-limit.read-per-minute=${RATE_LIMIT_READ:100}
ledger.security.rate-limit.write-per-minute=${RATE_LIMIT_WRITE:20}

# ========================================
# API Documentation (Swagger/OpenAPI)
# ========================================
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=${SWAGGER_ENABLED:true}
springdoc.swagger-ui.operations-sorter=alpha
springdoc.swagger-ui.tags-sorter=alpha

# ========================================
# Logging
# ========================================
logging.level.root=${LOG_LEVEL_ROOT:INFO}
logging.level.com.munitax.ledger=${LOG_LEVEL_APP:INFO}
logging.level.org.springframework.web=${LOG_LEVEL_WEB:INFO}
logging.level.org.springframework.security=${LOG_LEVEL_SECURITY:INFO}
logging.level.org.hibernate.SQL=${LOG_LEVEL_SQL:WARN}

# Log File Configuration
logging.file.name=${LOG_FILE_PATH:/var/log/munitax/ledger-service.log}
logging.file.max-size=10MB
logging.file.max-history=30
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ========================================
# Actuator (Health Checks & Monitoring)
# ========================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.health.db.enabled=true
management.health.diskspace.enabled=true
management.metrics.export.prometheus.enabled=true

# ========================================
# Resilience4j Circuit Breaker
# ========================================
resilience4j.circuitbreaker.instances.paymentGateway.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.paymentGateway.wait-duration-in-open-state=60000
resilience4j.circuitbreaker.instances.paymentGateway.sliding-window-size=10
resilience4j.circuitbreaker.instances.paymentGateway.minimum-number-of-calls=5

# ========================================
# Retry Configuration
# ========================================
resilience4j.retry.instances.database.max-attempts=3
resilience4j.retry.instances.database.wait-duration=1000
resilience4j.retry.instances.database.retry-exceptions=org.springframework.dao.DataAccessException

# ========================================
# Performance Tuning
# ========================================
server.tomcat.threads.max=${SERVER_THREADS_MAX:200}
server.tomcat.threads.min-spare=${SERVER_THREADS_MIN:10}
server.tomcat.accept-count=${SERVER_ACCEPT_COUNT:100}
server.tomcat.max-connections=${SERVER_MAX_CONNECTIONS:10000}

# ========================================
# Tenant/Municipality Configuration
# ========================================
ledger.tenant.default-currency=USD
ledger.tenant.default-locale=en_US
ledger.tenant.fiscal-year-start-month=1

# ========================================
# Feature Flags
# ========================================
ledger.features.refunds-enabled=${FEATURE_REFUNDS_ENABLED:true}
ledger.features.ach-payments-enabled=${FEATURE_ACH_ENABLED:true}
ledger.features.wire-transfers-enabled=${FEATURE_WIRE_ENABLED:false}
ledger.features.auto-reconciliation-enabled=${FEATURE_AUTO_RECON_ENABLED:false}

# ========================================
# Audit Configuration
# ========================================
ledger.audit.retention-days=${AUDIT_RETENTION_DAYS:2555}
ledger.audit.log-all-operations=${AUDIT_LOG_ALL:true}
ledger.audit.log-read-operations=${AUDIT_LOG_READS:false}

# ========================================
# Report Generation
# ========================================
ledger.reports.pdf-generation-timeout=${REPORT_PDF_TIMEOUT:30000}
ledger.reports.max-transactions-per-statement=${REPORT_MAX_TXN:1000}

# ========================================
# ENVIRONMENT-SPECIFIC OVERRIDES
# ========================================
# These can be overridden by:
# 1. application-{profile}.properties (e.g., application-prod.properties)
# 2. Environment variables
# 3. Command-line arguments
# 4. External configuration server (Spring Cloud Config)
#
# Example environment variable names:
# - DATABASE_URL
# - DATABASE_USERNAME
# - DATABASE_PASSWORD
# - PAYMENT_MODE
# - CORS_ALLOWED_ORIGINS
# - RATE_LIMIT_ENABLED
